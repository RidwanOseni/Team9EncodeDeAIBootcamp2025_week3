import prisma from '../../../lib/prisma'; import { openai } from '../../../lib/openai'; import { NextResponse } from 'next/server';
export async function POST() { const chars = await prisma.character.findMany(); const prompt = `Generate a creative story featuring these characters: ${chars.map(c => `${c.name} (${c.description}, ${c.personality})`).join('; ')}. Provide JSON mapping each character to their role.`; const res = await openai.chat.completions.create({ model: 'gpt-4', messages: [{ role: 'user', content: prompt }] }); const content = res.choices[0].message.content; const [storyPart, jsonPart] = content.split('```json'); let summary = {}; try { summary = JSON.parse(jsonPart.replace(/```/g, '').trim()); } catch {} return NextResponse.json({ story: storyPart.trim(), summary }); }